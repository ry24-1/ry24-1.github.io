<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HTMLä»£ç æäº¤ç³»ç»Ÿ</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            color: #333;
            line-height: 1.6;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        .subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
        }
        
        .card {
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            padding: 30px;
            margin-bottom: 30px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2c3e50;
        }
        
        input, textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e1e8ed;
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        input:focus, textarea:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
        }
        
        textarea {
            min-height: 200px;
            font-family: monospace;
            resize: vertical;
        }
        
        .file-upload {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
        }
        
        .file-input {
            display: none;
        }
        
        .file-label {
            display: inline-block;
            background: #f8f9fa;
            border: 2px dashed #bdc3c7;
            padding: 10px 15px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
            flex: 1;
        }
        
        .file-label:hover {
            border-color: #3498db;
            background: #e3f2fd;
        }
        
        .btn {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
            color: white;
            border: none;
            padding: 14px 25px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.4);
        }
        
        .btn:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .result-section {
            display: none;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #e1e8ed;
        }
        
        .result-box {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .url-display {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 15px 0;
        }
        
        .url-display a {
            color: #3498db;
            word-break: break-all;
            flex: 1;
        }
        
        .action-buttons {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }
        
        .btn-print {
            background: linear-gradient(135deg, #27ae60 0%, #229954 100%);
        }
        
        .btn-qr {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
        }
        
        .qr-container {
            text-align: center;
            margin-top: 20px;
        }
        
        .qr-code {
            margin: 0 auto;
            padding: 15px;
            background: white;
            border-radius: 8px;
            display: inline-block;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .gallery-section h2 {
            margin-bottom: 20px;
            color: #2c3e50;
            text-align: center;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
        
        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #e1e8ed;
        }
        
        th {
            background: #f8f9fa;
            font-weight: 600;
            color: #2c3e50;
        }
        
        tr:hover {
            background: #f8f9fa;
        }
        
        .action-cell {
            display: flex;
            gap: 10px;
        }
        
        .action-btn {
            background: none;
            border: none;
            font-size: 1.2rem;
            cursor: pointer;
            padding: 5px;
            border-radius: 4px;
            transition: all 0.2s;
        }
        
        .action-btn:hover {
            background: #e1e8ed;
            transform: scale(1.1);
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        
        .modal-content {
            background: white;
            border-radius: 15px;
            padding: 30px;
            max-width: 90%;
            max-height: 90%;
            overflow: auto;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            text-align: center;
        }
        
        .close-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #7f8c8d;
        }
        
        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }
        
        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-left-color: #3498db;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .card {
                padding: 20px;
            }
            
            th, td {
                padding: 8px 10px;
            }
            
            .action-buttons {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸš€ HTMLä½œä¸šä»£ç æäº¤ç³»ç»Ÿ</h1>
            <p class="subtitle">å›½åº†ä½œä¸šï¼Œä¸€å®šè¦å†™ï¼</p>
        </header>
        <div class="card">
            <h2>æäº¤ä½ çš„HTMLé¡µé¢</h2>
            <form id="html-form">
                <div class="form-group">
                    <label for="page-title">é¡µé¢æ ‡é¢˜</label>
                    <input type="text" id="page-title" placeholder="ä¸ºä½ çš„é¡µé¢èµ·ä¸€ä¸ªæ ‡é¢˜" required>
                </div>
                <div class="form-group">
                    <label for="html-code">HTMLä»£ç </label>
                    <textarea id="html-code" placeholder="åœ¨æ­¤å¤„ç²˜è´´ä½ çš„HTMLä»£ç ..." required></textarea>
                    <div class="file-upload">
                        <input type="file" id="html-file" class="file-input" accept=".html,.htm">
                        <label for="html-file" class="file-label">ğŸ“ æˆ–ä¸Šä¼ HTMLæ–‡ä»¶</label>
                    </div>
                </div>
                <button type="submit" class="btn" id="submit-btn">
                    <span>ğŸš€ æäº¤é¡µé¢</span>
                </button>
            </form>
            <div class="loading" id="loading">
                <div class="spinner"></div>
                <p>æäº¤ä¸­ï¼Œè¯·ç¨å€™...</p>
            </div>
            <div class="result-section" id="result-section">
                <h3>ğŸ‰ æäº¤æˆåŠŸï¼</h3>
                <div class="result-box">
                    <p><strong>é¡µé¢æ ‡é¢˜ï¼š</strong><span id="result-title"></span></p>
                    <div class="url-display">
                        <span>ğŸ”—</span>
                        <a id="result-url" target="_blank">åŠ è½½ä¸­...</a>
                    </div>
                </div>
                <div class="qr-container" id="qr-container">
                    <h4>ğŸ“¶ æ‰«æäºŒç»´ç è®¿é—®</h4>
                    <div class="qr-code" id="qr-code"></div>
                </div>
                <div class="action-buttons">
                    <button class="btn btn-print" onclick="printSubmission()">
                        ğŸ–¨ï¸ æäº¤å‡­è¯
                    </button>
                    <button class="btn btn-qr" onclick="downloadQRCode()">
                        ğŸ“¥ ä¸‹è½½äºŒç»´ç 
                    </button>
                </div>
            </div>
        </div>
        <div class="card gallery-section">
            <h2>ğŸ¨ åŒå­¦ä»¬çš„ä½œå“å±•ç¤º</h2>
            <div class="table-container">
                <table id="submissions-table">
                    <thead>
                        <tr>
                            <th width="10%">ç¼–å·</th>
                            <th width="30%">ä½œå“æ ‡é¢˜</th>
                            <th width="20%">æäº¤æ—¶é—´</th>
                            <th width="25%">è®¿é—®é“¾æ¥</th>
                            <th width="15%">æ“ä½œ</th>
                        </tr>
                    </thead>
                    <tbody id="table-body"></tbody>
                </table>
            </div>
        </div>
    </div>
    <div class="modal" id="qr-modal">
        <div class="modal-content">
            <button class="close-btn" onclick="closeModal('qr-modal')">Ã—</button>
            <h3>ğŸ“¶ æ‰«æäºŒç»´ç è®¿é—®</h3>
            <div id="modal-qr-code"></div>
            <p id="modal-title" style="margin-top: 15px;"></p>
        </div>
    </div>
    <div class="modal" id="preview-modal">
        <div class="modal-content">
            <button class="close-btn" onclick="closeModal('preview-modal')">Ã—</button>
            <h3>ğŸ‘ï¸ é¡µé¢é¢„è§ˆ</h3>
            <iframe id="preview-frame" style="width: 100%; height: 500px; border: 1px solid #e1e8ed; border-radius: 8px; margin-top: 15px;"></iframe>
        </div>
    </div>
	<script>
        const SUPABASE_URL = 'https://idfvdeujsfaemiieihmb.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlkZnZkZXVqc2ZhZW1paWVpaG1iIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg2OTkwMTMsImV4cCI6MjA3NDI3NTAxM30.SV22TpTweV1w4VVDPias74cw1l1tCJTXTtK8MeG0MqY';
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        let currentProject = null;
        let allSubmissions = [];
        document.addEventListener('DOMContentLoaded', function() {
            initializeForm();
            loadSubmissions();
        });
        function initializeForm() {
            const form = document.getElementById('html-form');
            const fileInput = document.getElementById('html-file');
            form.addEventListener('submit', handleSubmit);
            fileInput.addEventListener('change', handleFileUpload);
            document.getElementById('page-title').addEventListener('input', validateForm);
            document.getElementById('html-code').addEventListener('input', validateForm);
        }
        function handleFileUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = function(e) {
                document.getElementById('html-code').value = e.target.result;
                validateForm();
            };
            reader.readAsText(file);
        }
        function validateForm() {
            const hasTitle = document.getElementById('page-title').value.trim();
            const hasCode = document.getElementById('html-code').value.trim();
            document.getElementById('submit-btn').disabled = !(hasTitle && hasCode);
        }
        async function handleSubmit(e) {
            e.preventDefault();
            const submitBtn = document.getElementById('submit-btn');
            const loading = document.getElementById('loading');
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<span>â³ æäº¤ä¸­...</span>';
            loading.style.display = 'block';
            try {
                const formData = {
                    pageTitle: document.getElementById('page-title').value.trim(),
                    htmlCode: document.getElementById('html-code').value.trim(),
                    submittedAt: new Date().toISOString(),
                    projectId: generateProjectId()
                };
                const fileUrl = await uploadHtmlToSupabase(formData);
                formData.fileUrl = fileUrl;
                await saveProjectToDatabase(formData);
                showResult(formData);
                loadSubmissions();
            } catch (error) {
                console.error('æäº¤å¤±è´¥:', error);
                alert('æäº¤å¤±è´¥ï¼Œè¯·é‡è¯•: ' + error.message);
            } finally {
                submitBtn.disabled = false;
                submitBtn.innerHTML = '<span>ğŸš€ æäº¤é¡µé¢</span>';
                loading.style.display = 'none';
            }
        }
		async function uploadHtmlToSupabase(project) {
            const blob = new Blob([project.htmlCode], { type: 'text/html' });
            const fileName = `${project.projectId}.html`;
            const filePath = `projects/${fileName}`;
            const { data, error } = await supabase.storage
                .from('html-projects')
                .upload(filePath, blob);
            if (error) throw error;
            const { data: { publicUrl } } = supabase.storage
                .from('html-projects')
                .getPublicUrl(filePath);
			return publicUrl;
        }
        async function saveProjectToDatabase(project) {
            const { data, error } = await supabase
                .from('html_submissions')
                .insert([{
                    project_id: project.projectId,
                    page_title: project.pageTitle,
                    file_url: project.fileUrl,
                    submitted_at: project.submittedAt
                }]);
            if (error) throw error;
            return data;
        }
        function generateProjectId() { return 'html_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9); }
        function showResult(project) {
            currentProject = project;
            document.getElementById('result-title').textContent = project.pageTitle;
            const showPageUrl = `https://ry24-1.github.io/show.html?id=${project.projectId}`;
            const urlElement = document.getElementById('result-url');
            urlElement.href = showPageUrl;
            urlElement.textContent = showPageUrl;
            document.getElementById('result-section').style.display = 'block';
            generateQRCode(showPageUrl, 'qr-code');
            document.getElementById('result-section').scrollIntoView({ behavior: 'smooth' });
        }
        function generateQRCode(url, containerId) {
            const container = document.getElementById(containerId);
            container.innerHTML = '';
            QRCode.toCanvas(url, { 
                width: 200,
                height: 200,
                margin: 1,
                color: {
                    dark: '#2c3e50',
                    light: '#ffffff'
                }
            }, function(err, canvas) {
                if (err) {
                    console.error('ç”ŸæˆäºŒç»´ç å¤±è´¥:', err);
                    container.innerHTML = '<p>äºŒç»´ç ç”Ÿæˆå¤±è´¥</p>';
                    return;
                }
                container.appendChild(canvas);
            });
        }
        async function loadSubmissions() {
            try {
                const { data, error } = await supabase
                    .from('html_submissions')
                    .select('*')
                    .order('submitted_at', { ascending: false });
                if (error) throw error;
                allSubmissions = data || [];
                renderSubmissionsTable();
            } catch (error) { console.error('åŠ è½½ä½œå“å¤±è´¥:', error); }
        }
        function renderSubmissionsTable() {
            const tableBody = document.getElementById('table-body');
            if (allSubmissions.length === 0) {
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="5" style="text-align: center; padding: 40px; color: #7f8c8d;">
                            è¿˜æ²¡æœ‰åŒå­¦æäº¤ä½œå“ï¼Œæˆä¸ºç¬¬ä¸€ä¸ªå§ï¼
                        </td>
                    </tr>
                `;
                return;
            }
            tableBody.innerHTML = allSubmissions.map((submission, index) => `
                <tr>
                    <td>${index + 1}</td>
                    <td>${submission.page_title}</td>
                    <td>${formatTime(submission.submitted_at)}</td>
                    <td>
                        <a href="show.html?id=${submission.project_id}" target="_blank">ğŸ”— è®¿é—®é¡µé¢</a>
                    </td>
                    <td class="action-cell">
                        <button class="action-btn" onclick="showQRCode('https://ry24-1.github.io/show.html?id=${submission.project_id}', '${submission.page_title}')" title="æŸ¥çœ‹äºŒç»´ç ">
                            ğŸ“¶
                        </button>
                        <button class="action-btn" onclick="previewPage('show.html?id=${submission.project_id}')" title="é¢„è§ˆé¡µé¢">
                            ğŸ‘ï¸
                        </button>
                    </td>
                </tr>
            `).join('');
        }
        function showQRCode(url, title) {
            const modal = document.getElementById('qr-modal');
            const qrContainer = document.getElementById('modal-qr-code');
            const titleElement = document.getElementById('modal-title');
            qrContainer.innerHTML = '';
            titleElement.textContent = title;
            generateQRCode(url, 'modal-qr-code');
            modal.style.display = 'flex';
        }
        function previewPage(url) {
            const modal = document.getElementById('preview-modal');
            const frame = document.getElementById('preview-frame');
            frame.src = url;
            modal.style.display = 'flex';
        }
        function closeModal(modalId) { document.getElementById(modalId).style.display = 'none'; }
        function printSubmission() {
			if (!currentProject) return;
            const printContent = `
                <div style="padding: 30px; font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;">
                    <h1 style="text-align: center; color: #2c3e50; margin-bottom: 30px;">HTMLä½œä¸šæäº¤å‡­è¯</h1>
                    <div style="margin: 20px 0;">
                        <p><strong>é¡µé¢æ ‡é¢˜ï¼š</strong>${currentProject.pageTitle}</p>
                        <p><strong>æäº¤æ—¶é—´ï¼š</strong>${new Date(currentProject.submittedAt).toLocaleString()}</p>
                        <p><strong>æºç é“¾æ¥ï¼š</strong>${currentProject.fileUrl}</p>
						<p><strong>è®¿é—®åœ°å€ï¼š</strong>${'https://ry24-1.github.io/show.html?id=' + currentProject.projectId}</p>
                    </div>
					<p style="text-align: center; margin-top: 30px; font-size: 12px; color: #7f8c8d;">
                        ç”±ry24-1.github.ioç”Ÿæˆ
                    </p>
                </div>
            `;
            const printWindow = window.open('', '_blank');
			printWindow.document.write(`
                <html>
                    <head>
                        <title>æäº¤å‡­è¯</title>
                    </head>
                    <body>${printContent}</body>
                </html>
            `);
        }
        function downloadQRCode() {
            if (!currentProject) return;
            const canvas = document.querySelector('#qr-code canvas');
            if (!canvas) {
                alert('äºŒç»´ç å°šæœªç”Ÿæˆ');
                return;
            }
            const link = document.createElement('a');
            link.download = `äºŒç»´ç _${currentProject.pageTitle}.png`;
            link.href = canvas.toDataURL('image/png');
            link.click();
        }
        function formatTime(isoString) {
            const date = new Date(isoString);
            const now = new Date();
            const diffMs = now - date;
            const diffMins = Math.floor(diffMs / 60000);
            const diffHours = Math.floor(diffMs / 3600000);
            const diffDays = Math.floor(diffMs / 86400000);
            if (diffMins < 1) return 'åˆšåˆš';
            if (diffMins < 60) return `${diffMins}åˆ†é’Ÿå‰`;
            if (diffHours < 24) return `${diffHours}å°æ—¶å‰`;
            if (diffDays < 7) return `${diffDays}å¤©å‰`;
            return date.toLocaleDateString();
        }
    </script>
</body>
</html>