<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>人大附中亦庄新城学校2024级1班</title>
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
		<link rel="shortcut icon" href="/resources/images/logo.png">
		<link rel="stylesheet" href="/resources/css/header.css">
		<link rel="stylesheet" href="/resources/css/paragraph.css">
		<link rel="stylesheet" href="/resources/css/search.css">
	</head>
	<body style="background-color: #d4d2ff; text-align: center;">
	<header>
		<ul class="topnav">
			<li><a class="active" href="/">主页</a></li>
			<li><a href="/files/">文件</a></li>
			<li><a href="/gallery/">图库</a></li>
			<li><a href="/homework/">作业</a></li>
			<li><a href="/news/">新闻</a></li>
			<li><a href="/subjects/">学科</a></li>
			<li><a href="/more/">更多</a></li>
			<li class="right"><a href="/about/">关于</a></li>
		</ul>
	</header>
		<div class="search-container">
			<div class="search-header">
				<p style="font-weight: bold; font-size: 30px;">班级文件资源检索系统</p>
				<p>根据文件名称、类型或学科进行检索（注：本站仅保存2025年7月1日以后的各个文件，作文集除外）</p>
			</div>
			<div class="search-box">
				<input type="text" id="search-input" placeholder="输入文件名称及关键词...">
				<button id="search-button">搜索</button>
			</div>
			<div class="filter-options">
				<div class="filter-group">
					<label for="file-type"><p>文件类型</p></label>
					<select id="file-type">
						<option value="">所有类型</option>
						<option value="pdf">PDF文档</option>
						<option value="docx">Word文档</option>
						<option value="pptx">PPT演示</option>
						<option value="xlsx">Excel表格</option>
						<option value="zip">zip压缩文件</option>
					</select>
				</div>
				<div class="filter-group">
					<label for="subject"><p>学科分类</p></label>
					<select id="subject">
						<option value="">所有学科</option>
						<option value="chinese">语文</option>
						<option value="math">数学</option>
						<option value="english">英语</option>
						<option value="physics">物理</option>
						<option value="chemistry">化学</option>
						<option value="biology">生物</option>
						<option value="history">历史</option>
						<option value="geography">地理</option>
						<option value="politics">政治</option>
						<option value="others">其他</option>
					</select>
				</div>
			</div>
			<div id="search-results" class="search-results" style="display: none;"></div>
		</div>
		<footer>
			<p>版权所有 &copy; 2025 人大附中亦庄新城学校2024级1班</p>
		</footer>
		<script>
		    let fileData = [];
		    const searchInput = document.getElementById('search-input');
		    const searchButton = document.getElementById('search-button');
		    const fileTypeSelect = document.getElementById('file-type');
		    const subjectSelect = document.getElementById('subject');
		    const searchResults = document.getElementById('search-results');
		    document.addEventListener('DOMContentLoaded', function() {
		        loadFileData();
		    });
		    function loadFileData() {
		        searchResults.innerHTML = '<div class="no-results">正在加载文件数据...</div>';
		        searchResults.style.display = 'block';
		        fetch('file_data.json')
		            .then(response => {
		                if (!response.ok) {
		                    throw new Error('网络响应不正常');
		                }
		                return response.json();
		            })
		            .then(data => {
		                fileData = data;
		                displayResults(fileData);
		            })
		            .catch(error => {
		                console.error('加载文件数据出错:', error);
		                searchResults.innerHTML = 
		                    '<div class="no-results">无法加载文件数据，请稍后再试。</div>';
		                searchResults.style.display = 'block';
		            });
		    }
		    function performSearch() {
		        const query = searchInput.value.trim().toLowerCase();
		        const fileType = fileTypeSelect.value;
		        const subject = subjectSelect.value;
		        if (!fileData.length) {
		            alert('文件数据正在加载中，请稍候...');
		            return;
		        }
		        if (!query && !fileType && !subject) {
		            displayResults(fileData);
		            return;
		        }
		        const results = fileData.filter(file => {
		            const textMatch = !query || 
		                file.title.toLowerCase().includes(query) || 
		                file.filename.toLowerCase().includes(query) || 
		                file.description.toLowerCase().includes(query);
		            const typeMatch = !fileType || file.type === fileType;
		            const subjectMatch = !subject || file.subject === subject;
		            return textMatch && typeMatch && subjectMatch;
		        });
		        displayResults(results);
		    }
		    function displayResults(results) {
		        searchResults.innerHTML = '';
		        if (results.length === 0) {
		            searchResults.style.display = 'block';
		            searchResults.innerHTML = '<div class="no-results">没有找到匹配的文件。</div>';
		            return;
		        }
		        results.forEach(file => {
		            const resultElement = document.createElement('div');
		            resultElement.className = 'result-item';
		            const fileExt = file.filename.split('.').pop().toLowerCase();
		            resultElement.innerHTML = `
		                <div class="file-icon ${file.type}">${fileExt}</div>
		                <div class="file-info">
		                    <div class="file-title">${file.title}</div>
		                    <div class="file-meta">
		                        <span><i>📄</i> ${file.filename}</span>
		                        <span><i>📚</i> ${getSubjectName(file.subject)}</span>
		                        <span><i>📏</i> ${file.size}</span>
		                        <span><i>📅</i> ${file.date}</span>
		                    </div>
		                    <div class="file-desc">${file.description}</div>
		                </div>
		                <a href="${file.downloadUrl}" class="download-btn" download>下载</a>
		            `;
		            
		            searchResults.appendChild(resultElement);
		        });
		        searchResults.style.display = 'block';
		    }
		    function getSubjectName(subjectCode) {
		        const subjects = {
		           chinese: "语文",
					math: "数学",
					english: "英语",
					physics: "物理",
					chemistry: "化学",
					biology: "生物",
					history: "历史",
					geography: "地理",
					politics: "道德与法治",
					others: "其他"
		        };
		        return subjects[subjectCode] || subjectCode;
		    }
		    searchButton.addEventListener('click', performSearch);
		    searchInput.addEventListener('keypress', function(e) {
		        if (e.key === 'Enter') {
		            performSearch();
		        }
		    });
		    fileTypeSelect.addEventListener('change', performSearch);
		    subjectSelect.addEventListener('change', performSearch);
		</script>
	</body>
</html>